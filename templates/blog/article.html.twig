{% extends 'base.html.twig' %}

{% block title %}Liste des Blogs{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1 class="text-center mb-4">üìú Liste des Articles du Blog</h1>

        <div class="row">
            {% for blog in blogs %}
                <div class="col-md-6 mb-4">
                    <div class="card shadow-sm border-0 rounded-lg overflow-hidden">
                        <div class="card-img-top text-center p-3 bg-light">
                            <img src="{{ asset('uploads/images/' ~ blog.image) }}" class="img-fluid rounded" style="height: 200px; object-fit: cover;">
                        </div>
                        <div class="card-body">
                            <h5 class="card-title fw-bold">{{ blog.titre }}</h5>
                            <p class="card-text text-muted">{{ blog.contenu|length > 100 ? blog.contenu|slice(0, 100) ~ '...' : blog.contenu }}</p>
                            <p class="text-muted">
                                <small>üóì Publi√© le : {{ blog.datePublication ? blog.datePublication|date('Y-m-d H:i:s') : 'Non dat√©' }}</small>
                            </p>

                            <!-- Like / Dislike Buttons -->
                            <div class="d-flex justify-content-center align-items-center mb-3">
                                <!-- Like Button -->
                                <div class="me-4 text-center">
                                    <form action="{{ path('blog_like', {id: blog.idArticle}) }}" method="post">
                                        <button type="submit" class="btn btn-outline-success btn-sm" aria-label="J'aime cet article">üëç</button>
                                    </form>
                                    <p>{{ blog.getLikeCount() }} </p>
                                </div>

                                <!-- Dislike Button -->
                                <div class="text-center">
                                    <form action="{{ path('blog_dislike', {id: blog.idArticle}) }}" method="post">
                                        <button type="submit" class="btn btn-outline-danger btn-sm" aria-label="Je n'aime pas cet article">üëé</button>
                                    </form>
                                    <p>{{ blog.getDislikeCount() }} </p>
                                </div>
                            </div>

                            <!-- Comment Form -->
                            <form action="{{ path('blog_comment', {id: blog.idArticle}) }}" method="post" class="mt-3">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="comment_content" placeholder="√âcrire un commentaire..." required aria-label="Contenu du commentaire">
                                    <button class="btn btn-primary" type="submit">Envoyer</button>
                                </div>
                            </form>

                            <!-- Display Comments -->
                            <ul class="list-group list-group-flush mt-3">
                                {% for commentaire in blog.commentaires %}
                                    <li class="list-group-item">
                                        <strong>{{ commentaire.utilisateur.username }}:</strong> 
                                        {{ commentaire.contenu }}
                                        <small class="text-muted float-end">{{ commentaire.dateCommentaire|date('Y-m-d H:i') }}</small>
                                    </li>
                                {% else %}
                                    <li class="list-group-item text-center text-muted">Aucun commentaire pour cet article.</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            {% else %}
                <p class="text-center">üòû Aucun article trouv√©.</p>
            {% endfor %}
        </div>

        <!-- Pagination (Si applicable) -->
        <div class="pagination-container mt-4 d-flex justify-content-center">
            {# Si vous avez des pages pour afficher les articles, vous pouvez activer cette section. #}
            {# <nav aria-label="Page navigation example"> #}
            {#     <ul class="pagination"> #}
            {#         <li class="page-item"><a class="page-link" href="#">&laquo; Pr√©c√©dent</a></li> #}
            {#         <li class="page-item"><a class="page-link" href="#">1</a></li> #}
            {#         <li class="page-item"><a class="page-link" href="#">2</a></li> #}
            {#         <li class="page-item"><a class="page-link" href="#">Suivant &raquo;</a></li> #}
            {#     </ul> #}
            {# </nav> #}
        </div>
    </div>
{% endblock %}